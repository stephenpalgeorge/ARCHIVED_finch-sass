@use 'sass:map';
@use '../config';
@use '../layout';

/// ----------
/// MODULE SETUP
/// ----------
$use-web-safe: false !default;
/// @author stephen pal-george
/// This map controls whether the styles are generated specifically for each breakpoint.
/// If true, then placeholders and classes such as `(\.|%)sm\:size--lead` will be created.
$font-responsive: (
  font-family: false,
  font-size: false,
  font-weight: false,
  line-height: false,
  letter-spacing: false,
  text-align: false,
  word-spacing: false,
);
/// provide custom 'responsive' settings for this module.
/// @example @use '<path-to-finch>/typography' with ($set-responsive: (font-size: true));
$set-responsive: () !default;
$responsive: map.merge($font-responsive, $set-responsive);

/// @author stephen pal-george
/// This map controls whether or not utility classes are generated. By default,
/// Finch will create everything within it's module's partials as placeholders (%),
/// rather than classes (.). Switching any of these values to `true` will create the
/// classes as well.
$font-utilities: (
  font-family: false,
  font-size: false,
  font-weight: false,
  line-height: false,
  letter-spacing: false,
  text-align: false,
  word-spacing: false,
);
/// provide custom 'utilities' settings for this module.
/// @example @use '<path-to-finch>/typography' with ($set-utilities: (font-weight: true));
$set-utilities: () !default;
$utilities: map.merge($font-utilities, $set-utilities);
  
@use '../_mixins' as m with ($responsive-map: $responsive, $utilities-map: $utilities);

/// FONT-FAMILIES
/// ----------
/// provide custom font-families for the module, these are consumed by the _font-families partial.
/// @example @use '<path-to-finch>/typography' with ($font-families: (headings: <url-to-font>));
$font-families: () !default;
@use 'font-families' as * with (
  $set-font-families: $font-families,
  $font-family-utils: map.get($utilities, font-family),
  $prefer-web-safe: $use-web-safe,
);

/// FONT-SIZE
/// ----------
/// provide custom font-sizes for the module, these are consumed by the _font-sizes partial.
/// @example @use '<path-to-finch>/typography' with ($font-sizes: (headline: 5rem));
$font-sizes: () !default;
@use 'font-sizes' as * with (
  $set-font-sizes: $font-sizes,
  $size-utils: map.get($utilities, font-size),
);

/// FONT-WEIGHT
/// ----------
/// provide custom font-weights for the module, these are consumed by the _font-weights partial.
/// @example @use '<path-to-finch>/typography' with ($font-weights: (heavy: 800));
$font-weights: () !default;
@use 'font-weights' as * with (
  $set-font-weights: $font-weights,
  $weight-utils: map.get($utilities, font-weight),
);

/// LETTER-SPACING
/// ----------
/// provide custom letter-spacings for the module, these are consumed by the _letter-spacings partial.
/// @example @use '<path-to-finch>/typography' with ($letter-spacings: (x-wide: .25rem));
$letter-spacings: () !default;
@use 'letter-spacings' as * with (
  $set-letter-spacings: $letter-spacings,
  $letter-spacing-utils: map.get($utilities, letter-spacing),
);

/// LINE-HEIGHT
/// ----------
/// provide custom line-heights for the module, these are consumed by the _line-heights partial.
/// @example @use '<path-to-finch>/typography' with ($line-heights: (x-tall: 2));
$line-heights: () !default;
@use 'line-heights' as * with (
  $set-line-heights: $line-heights,
  $line-height-utils: map.get($utilities, line-height),
);

/// TEXT-ALIGN
/// ----------
@use 'text-align' as * with (
  $text-align-utils: map.get($utilities, text-align),
);

/// WORD-SPACING
/// ----------
/// provide custom word-spacings for the module, these are consumed by the _word-spacings partial.
/// @example @use '<path-to-finch>/typography' with ($word-spacings: (stretch: 1px));
$word-spacings: () !default;
@use 'word-spacings' as * with (
  $set-word-spacings: $word-spacings,
  $word-spacing-utils: map.get($utilities, word-spacing),
);

// create responsize class names:
// the following code generates classes such as `sm:size--lead`, or `xl:weight--heavy`.
// the classes will only be generated if the corresponding property is set to 'true' in
// the $font-responsive and $font-utilities maps.
@each $key, $value in layout.$breakpoints {
  @include layout.break($key) {
    @include m.gen-responsive($key, 'font-family', 'font', $families);
    @include m.gen-responsive($key, 'font-size', 'size', $sizes);
    @include m.gen-responsive($key, 'font-weight', 'weight', $weights);
    @include m.gen-responsive($key, 'line-height', 'line-height', $heights);
    @include m.gen-responsive($key, 'letter-spacing', 'letter-spacing', $l-spacings);
    @include m.gen-responsive($key, 'text-align', 'text-align', $alignments);
    @include m.gen-responsive($key, 'word-spacing', 'word-spacing', $w-spacings);
  }
}

@mixin text-style(
  $alignment: start,
  $family: sans-serif,
  $letter-spacing: base,
  $line-height: base,
  $size: base,
  $weight: base,
  $word-spacing: base
) {
  font-family: font-family($family);
  font-size: size($size);
  font-weight: weight($weight);
  letter-spacing: letter-spacing($letter-spacing);
  line-height: line-height($line-height);
  text-align: $alignment;
  word-spacing: word-spacing($word-spacing);
  // set some recommended values that aren't browser defaults.
  // In some cases, these won't have any affect as they are not well supported,
  // and the end-user can always override them in their stylesheets anyway...
  font-kerning: normal;
}

.text-body {
  @include text-style($line-height: tall);
  max-width: 60ch;
}

.text-lead {
  @include text-style($size: lead, $weight: x-light);
  // this next line is just here for demo purposes, this kind of thing should live in the layout module
  max-width: 50ch;
}

.text-subheading {
  @include text-style($family: serif, $size: sub-heading, $line-height: tight);
}

.text-heading {
  @include text-style($family: serif, $size: heading, $line-height: tight, $weight: heavy);
}

// ALL OF THIS FOLLOWING CODE SHOULD ONE DAY LIVE IN AN 'Elements' MODULE, it's here for now
// as a proof of concept/demo kind of thing.
h1 {
  @extend .text-heading;
  // this next line is just here for demo purposes, this kind of thing should live in the layout module
  max-width: 15ch;
}

h2, h3 {
  @extend .text-subheading;
  font-weight: weight(heavy);
  // this next line is just here for demo purposes, this kind of thing should live in the layout module
  max-width: 25ch;
}
h3 {
  font-weight: weight(base);
}

p:not([class]) {
  @extend .text-body;
}